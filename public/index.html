<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lost & Found</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .card{ @apply bg-white/90 backdrop-blur rounded-xl shadow p-5 border border-gray-100 }
      .btn{ @apply inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium shadow-sm }
      .btn-primary{ @apply bg-indigo-600 text-white hover:bg-indigo-700 }
      .btn-success{ @apply bg-emerald-600 text-white hover:bg-emerald-700 }
      .btn-danger{ @apply bg-rose-600 text-white hover:bg-rose-700 }
      .input{ @apply border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 }
      .label{ @apply text-xs font-medium text-gray-600 }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-emerald-50">
    <nav class="sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-gray-100">
      <div class="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 rounded-lg bg-indigo-600 text-white grid place-items-center font-semibold">LF</div>
          <span class="font-semibold">Lost & Found</span>
        </div>
        <div class="flex gap-2">
          <button id="runMatch" class="btn btn-primary">Run AutoMatch</button>
          <button id="resetDb" class="btn btn-danger">Reset DB</button>
        </div>
      </div>
    </nav>

    <div class="max-w-6xl mx-auto p-6">
      <header class="mb-6">
        <h1 class="text-2xl font-bold">Report and match items</h1>
        <p class="text-gray-600">Add lost or found items; AutoMatch links likely pairs by name, category and location.</p>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Report Lost Item</h2>
          <form id="lostForm" class="grid gap-3">
            <label class="grid gap-1">
              <span class="label">Item name</span>
              <input class="input" name="item_name" placeholder="e.g. AirPods Pro" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Category</span>
              <input class="input" name="category" placeholder="e.g. earphones" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Lost location</span>
              <input class="input" name="lost_location" placeholder="e.g. Library" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Description</span>
              <textarea class="input" name="description" placeholder="color, case, stickers..."></textarea>
            </label>
            <button class="btn btn-success">Submit Lost</button>
          </form>
        </div>

        <div class="card">
          <h2 class="text-lg font-semibold mb-2">Report Found Item</h2>
          <form id="foundForm" class="grid gap-3">
            <label class="grid gap-1">
              <span class="label">Item name</span>
              <input class="input" name="item_name" placeholder="e.g. AirPods Pro" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Category</span>
              <input class="input" name="category" placeholder="e.g. earphones" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Found location</span>
              <input class="input" name="found_location" placeholder="e.g. Cafeteria" required />
            </label>
            <label class="grid gap-1">
              <span class="label">Description</span>
              <textarea class="input" name="description" placeholder="where exactly, notes..."></textarea>
            </label>
            <button class="btn btn-primary">Submit Found</button>
          </form>
        </div>

        <div class="card md:col-span-1 md:row-span-2">
          <h2 class="text-lg font-semibold mb-2">Matches</h2>
          <div id="matches"></div>
        </div>
      </div>

      <footer class="text-center mt-10 text-sm text-gray-500">
        Built for your DBMS project • Oracle/SQLite compatible • AutoMatch demo
      </footer>
    </div>

    <script>
      const notify = (msg, ok=true) => {
        const el = document.createElement('div');
        el.className = `fixed top-4 right-4 px-4 py-2 rounded shadow text-white ${ok? 'bg-emerald-600':'bg-rose-600'}`;
        el.textContent = msg; document.body.appendChild(el); setTimeout(()=>el.remove(), 2000);
      };
      const api = (p) => fetch(p).then(async r => { if(!r.ok) throw new Error(await r.text()); return r.json(); });
      const post = (p, body) => fetch(p, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) }).then(async r => { if(!r.ok) throw new Error(await r.text()); return r.json(); });

      async function refresh() {
        const [lost, found, matches] = await Promise.all([
          api('/api/lost'), api('/api/found'), api('/api/matches')
        ]);
        const rows = matches.map(m => Array.isArray(m) ? {match_id:m[0],lost_id:m[1],found_id:m[2],match_date:m[3],status:m[4]} : m);
        document.getElementById('matches').innerHTML = `<table class="w-full text-sm"><thead><tr class="text-left"><th class="p-2 text-gray-600">Match</th><th class="p-2 text-gray-600">Lost ID</th><th class="p-2 text-gray-600">Found ID</th><th class="p-2 text-gray-600">Date</th><th class="p-2 text-gray-600">Status</th></tr></thead><tbody>${
          rows.map(m => `<tr class="odd:bg-gray-50"><td class="p-2">${m.match_id}</td><td class="p-2">${m.lost_id}</td><td class="p-2">${m.found_id}</td><td class="p-2">${m.match_date ?? ''}</td><td class="p-2">${m.status ?? ''}</td></tr>`).join('')
        }</tbody></table>`;
      }

      document.getElementById('lostForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        try { await post('/api/lost', data); notify('Lost item submitted'); e.target.reset(); refresh(); } catch(err){ notify(err.message,false); }
      });

      document.getElementById('foundForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target).entries());
        try { await post('/api/found', data); notify('Found item submitted'); e.target.reset(); refresh(); } catch(err){ notify(err.message,false); }
      });

      document.getElementById('runMatch').addEventListener('click', async () => {
        try { await post('/api/automatch', {}); notify('AutoMatch ran'); refresh(); } catch(err){ notify(err.message,false); }
      });

      document.getElementById('resetDb').addEventListener('click', async () => {
        if (!confirm('Reset all data?')) return;
        try { await post('/api/admin/reset', {}); notify('Database reset'); refresh(); } catch(err){ notify(err.message,false); }
      });

      refresh();
    </script>
  </body>
  </html>


